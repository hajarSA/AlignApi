<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Embedding the Alignment API</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" type="text/css" href="../../base.css" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<script type="text/javascript">
<!--
function show(id) {
	var element = document.getElementById(id);
	element.style.display = "block";
}
function hide(id) {
	var element = document.getElementById(id);
	element.style.display = "none";
}
-->
</script>
<style type="text/css">
<!--
div.logic {
	padding-left: 5px;
	padding-right: 5px;
	margin-top: 10px;
	margin-bottom: 10px;
}
-->
</style>
</head>
<body style="background-color: #FFFFFF;">

<h1>Embedding the Alignment <abbr title="Application Programming Interface">API</abbr></h1>

<dl>
<dt>This version:</dt>
<dd>http://alignapi.gforge.inria.fr/tutorial/tutorial3/embed.html</dd>
<dt>Author:</dt>
<dd><a href="http://exmo.inrialpes.fr/people/euzenat">J&eacute;r&ocirc;me Euzenat</a>, INRIA &amp; LIG
</dd>
</dl>

<p style="border-bottom: 2px solid #AAAAAA; border-top: 2px solid
	  #AAAAAA; padding-top: 15px; padding-bottom: 15px;">Here is a
  tutorial for embedding the alignment <abbr>API</abbr> within your
	  own applications. 
</p>

	
<h2>The data</h2>
	
<p>Your mission, if you accept it, will be to find the best alignment between two bibliographic ontologies. They can be seen here:</p>
<dl>
  <dt>edu.mit.visus.bibtex.owl</dt>
  <dd>is a relatively faithfull transcription of BibTeX as an ontology. It can be seen here in <a href="edu.mit.visus.bibtex.owl"><abbr title="Ressource Description Framework">RDF</abbr>/<abbr title="eXtansible Markup Language">XML</abbr></a> or <a href="edu.mit.visus.bibtex.html"><abbr>HTML</abbr></a>.</dd>
  <dt>myOnto.owl</dt>
  <dd>is an extension of the previous one that contains a number of supplementary concepts. It can be seen here in <a href="myOnto.owl"><abbr>RDF</abbr>/<abbr>XML</abbr></a> or <a href="myOnto.html"><abbr>HTML</abbr></a>.</dd>
</dl>

<p>These two ontologies have been used for a few years in the <a href="oaei.ontologymatching.org">Ontology Alignment Evaluation Initiative</a>.</p>
	
<h2>Embedding</h2>
	
<p>Of course, the goal of this <abbr>API</abbr> is not to be used at the command line level (even if it can be very useful). So if you are ready for it, you can develop in Java your own application that takes advantage of the <abbr>API</abbr>.</p>

<p>A skeleton of program using the Alignment <abbr>API</abbr> is <a href="Skeleton.java">Skeleton.java</a>. It can be compiled by invoking:</p>
<div class="fragment">
$ javac -classpath ../../lib/align.jar:../../lib/procalign.jar -d results Skeleton.java
</div>
<p>and run by:</p>
<div class="fragment">
$ java -cp ../../lib/Procalign.jar:results Skeleton file://$CWD/myOnto.owl file://$CWD/edu.mit.visus.bibtex.owl
</div>

<p>Now considering the <abbr>API</abbr> (that can be consulted through its thin <a href="../../javadoc/org/semanticweb/owl/align/Alignment.html">Javadoc</a> for instance), can you modify the Skeleton program in order for it performs the following:</p>
<ul>
  <li>Run two different alignment methods (e.g., ngram distance and smoa);</li>
  <li>Merge the two results;</li>
  <li>Trim at various thresholds;</li>
  <li>Evaluate them against the reference alignment and choose the one with the best F-Measure;</li>
  <li>Displays it as <acronym title="The web ontology language OWL">OWL</acronym> Rules.</li>
</ul>

<p>Of course, you can do it progressively.</p>
<div class="fragment">
$ javac -classpath ../../lib/align.jar:../../lib/procalign.jar -d results MyApp.java
$ java -cp ../../lib/Procalign.jar:results MyApp file://$CWD/myOnto.owl file://$CWD/edu.mit.visus.bibtex.owl > results/MyApp.owl
</div>

<p>Do you want to see a possible solution?</p>
<div class="button">
  <input type="button" onclick="show('qu7')" value="Cheat"/>
  <input type="button" onclick="hide('qu7')" value="Teacher is comming"/>
</div>
<div class="explain" id="qu7"><p>The main piece of code in Skeleton.java is replaced by:</p>
<pre>
  // Run two different alignment methods (e.g., ngram distance and smoa)
  AlignmentProcess a1 = new StringDistAlignment();
  params.setParameter("stringFunction","smoaDistance");
  a1.init ( onto1, onto2 );
  a1.align( (Alignment)null, params );
  AlignmentProcess a2 = new StringDistAlignment();
  a2.init ( onto1, onto2 );
  params = new BasicParameters();
  params.setParameter("stringFunction","ngramDistance");
  a2.align( (Alignment)null, params );

  // Merge the two results.
  ((BasicAlignment)a1).ingest(a2);

  // Threshold at various thresholds
  // Evaluate them against the references
  // and choose the one with the best F-Measure
  AlignmentParser aparser = new AlignmentParser(0);
  // Changed by Angel for Windows
  //Alignment reference = aparser.parse( "file://"+(new File ( "refalign.rdf" ) . getAbsolutePath()) );
  Alignment reference = aparser.parse( (new File ( "refalign.rdf" ) ) . toURL() . toString());
  Evaluator evaluator = new PRecEvaluator( reference, a1 );

  double best = 0.;
  Alignment result = null;
  Parameters p = new BasicParameters();
  for ( int i = 0; i <= 10 ; i += 2 ){
    a1.cut( ((double)i)/10 );
    evaluator = new PRecEvaluator( reference, a1 );
    evaluator.eval( p );
    System.err.println("Threshold "+(((double)i)/10)+" : "+((PRecEvaluator)evaluator).getFmeasure()+" over "+a1.nbCells()+" cells");
    if ( ((PRecEvaluator)evaluator).getFmeasure() > best ) {
       result = (BasicAlignment)((BasicAlignment)a1).clone();
       best = ((PRecEvaluator)evaluator).getFmeasure();
    }
  }
  // Displays it as OWL Rules
  PrintWriter writer = new PrintWriter (
		        new BufferedWriter(
	                 new OutputStreamWriter( System.out, "UTF-8" )), true);
  AlignmentVisitor renderer = new OWLAxiomsRendererVisitor(writer);
  a1.render(renderer);
  writer.flush();
  writer.close();
</pre></div>
<p>The execution provides an insight about the best threshold:
<pre>
Threshold 0.0 : 0.4693877551020408 over 148 cells
Threshold 0.2 : 0.5227272727272727 over 128 cells
Threshold 0.4 : 0.5476190476190476 over 120 cells
Threshold 0.6 : 0.6478873239436619 over 94 cells
Threshold 0.8 : 0.75 over 72 cells
Threshold 1.0 : 0.5151515151515151 over 18 cells
</pre>
<p>
<p>A full working solution is <a href="MyApp.java">MyApp.java</a>.</p>

<div class="logic"><p><b>More work:</b> Can you add a switch like the <tt>-i</tt> switch of <tt>Procalign</tt> so that the main class of the application can be passed at commant-line.</p></div>

<div class="logic"><p><b>Advanced:</b> You can develop a specialized matching algorithm by subclassing the Java programs provided in the Alignment <abbr>API</abbr> implementation (like BasicAlignment or DistanceAlignment).</p></div>

<div class="logic"><p><b>Advanced:</b> What about writing an editor for the alignment <abbr>API</abbr>?</p></div>
	
<h2>Further exercises</h2>
	
<p>More info: <a href="http://alignapi.gforge.inria.fr">http://alignapi.gforge.inria.fr</a></p>
	
<hr />
<small>
<p style="text-align: center;">http://alignapi.gforge.inria.fr/tutorial/tutorial3/embed.html</p>
</small>
<hr />
<p>$Id: index.html 1046 2009-07-09 12:24:53Z euzenat $</p>
</body>
</html>
